!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={};t(n),e.seriesQuery=n}}(this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setGlobalOptions=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Object.assign(o,e)};var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o={stale:!0,func:void 0,varyKeys:["page_size","page_num"],onLoadingChange:void 0},s=e.SeriesOrderError=function(e){function i(){var e;a(this,i);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(n)));return o.name="SeriesOrderError",o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,Error),i}(),t=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a(this,t),this.options=n({},o,e),this.queryingParams={},this.count=-1,this.lastId=-1,this.loadingId=-1,this.loading=!1}return r(t,[{key:"query",value:function(t){var n=this,e=this.options,r=e.func;if(!r||"function"!=typeof r)return Promise.reject(new TypeError("Please set Series-query query function"));var o=t;e.stale&&(o=this.queryingParams||{},e.varyKeys.forEach(function(e){Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=t[e])})),this.count=this.count+1;var i=this.count;return this.setLoading(i),r(o).then(function(e){if(n.setUnLoading(i),i<n.lastId){var t=new s;return t.data=e,t}return n.lastId=i,e}).catch(function(e){return n.setUnLoading(i),Promise.reject(e)})}},{key:"getStaleParams",value:function(){var t=n({},this.queryingParams);return this.options.varyKeys.forEach(function(e){t[e]=void 0}),t}},{key:"setQueryParams",value:function(e){this.queryingParams=JSON.parse(JSON.stringify(e))}},{key:"setLoading",value:function(e){this.loadingId=e,this.loading||(this.loading=!0,this.noticeLoading())}},{key:"setUnLoading",value:function(e){e<this.loadingId||(this.loading=!1,this.noticeLoading())}},{key:"noticeLoading",value:function(){var e=this.options.onLoadingChange;e&&e(this.loading)}}]),t}();e.default=t});